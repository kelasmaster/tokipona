<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Toki Pona Symbol + Translator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 20px;
    }
    #symbolResult {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .symbol-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      max-width: 140px;
    }
    .symbol-item img {
      width: 100px;
      height: 100px;
    }
    .word-label {
      margin-top: 5px;
      font-weight: bold;
    }
    .word-translation {
      font-size: 0.85em;
      color: #555;
    }
  </style>
</head>
<body>

  <h2>Toki Pona Symbol Viewer + Local Dictionary</h2>

  <input type="text" id="textInput" placeholder="Enter Toki Pona words (e.g. toki pona)" />
  <button onclick="loadSymbols()">Display</button>
  <button onclick="downloadSymbolOnly()">Download Symbols (PNG)</button>

  <div id="symbolResult"></div>

  <script>
    // âœ… Local Toki Pona dictionary
    const tokiPonaWordList = {
      "toki": "language, speech, talk",
      "pona": "good, simple, positive",
      "jan": "person, people",
      "moku": "food, eat",
      "suno": "sun, light",
      "kili": "fruit, vegetable",
      "telo": "water, liquid",
      "suli": "big, tall, important",
      "pini": "end, finish, completed",
      "open": "open, begin, start",
      "soweli": "animal, mammal",
      "ilo": "tool, machine",
      "kule": "color, paint",
      "sitelen": "image, writing, draw",
      "nasin": "path, road, way, doctrine"
      // Add more words as needed
    };

    // Convert image to base64
    async function toBase64(url) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "anonymous";
        img.src = url;
        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = img.naturalWidth;
          canvas.height = img.naturalHeight;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          resolve(canvas.toDataURL("image/png"));
        };
        img.onerror = function () {
          reject(new Error("Failed to load image: " + url));
        };
      });
    }

    function getTranslation(word) {
      return tokiPonaWordList[word] || "Unknown word";
    }

    async function loadSymbols() {
      const container = document.getElementById("symbolResult");
      container.innerHTML = "";
      const input = document.getElementById("textInput").value.trim().toLowerCase();
      if (!input) return;

      const words = input.split(/\s+/);
      for (const word of words) {
        const imgURL = `https://sitelen.nimi.li/img/${word}.png`;
        try {
          const base64img = await toBase64(imgURL);
          const translation = getTranslation(word);

          const wrapper = document.createElement("div");
          wrapper.className = "symbol-item";

          const img = document.createElement("img");
          img.src = base64img;
          img.alt = word;

          const wordLabel = document.createElement("div");
          wordLabel.className = "word-label";
          wordLabel.textContent = word;

          const transLabel = document.createElement("div");
          transLabel.className = "word-translation";
          transLabel.textContent = translation;

          wrapper.appendChild(img);
          wrapper.appendChild(wordLabel);
          wrapper.appendChild(transLabel);
          container.appendChild(wrapper);
        } catch (e) {
          console.warn("Could not load symbol for:", word);
        }
      }
    }

    function downloadSymbolOnly() {
      const container = document.getElementById("symbolResult");
      if (!container.children.length) {
        alert("No symbols to download!");
        return;
      }

      const clone = container.cloneNode(true);
      clone.style.background = "#ffffff";
      clone.style.padding = "20px";

      // Remove all text before download
      clone.querySelectorAll(".word-label, .word-translation").forEach(el => el.remove());

      document.body.appendChild(clone);
      html2canvas(clone, { backgroundColor: "#ffffff" }).then(canvas => {
        const link = document.createElement("a");
        link.download = "toki-pona-symbols.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
        document.body.removeChild(clone);
      });
    }
  </script>

</body>
</html>
