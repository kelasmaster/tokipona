<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toki Pona Grammar Checker</title>
    <style>
        :root {
            --primary-color: #FF6B6B;
            --secondary-color: #4ECDC4;
            --dark-color: #292F36;
            --light-color: #F7FFF7;
            --warning-color: #FFE66D;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--secondary-color);
            font-style: italic;
        }

        .app-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .input-section {
            margin-bottom: 20px;
        }

        textarea {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            resize: vertical;
            font-size: 16px;
            transition: border 0.3s;
        }

        textarea:focus {
            border-color: var(--secondary-color);
            outline: none;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            flex-grow: 1;
        }

        .check-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .check-btn:hover {
            background-color: #e05555;
        }

        .clear-btn {
            background-color: var(--dark-color);
            color: white;
        }

        .clear-btn:hover {
            background-color: #1a1f24;
        }

        .examples-btn {
            background-color: var(--secondary-color);
            color: white;
        }

        .examples-btn:hover {
            background-color: #3ab7af;
        }

        .results-section {
            margin-top: 20px;
        }

        .error-list {
            list-style-type: none;
        }

        .error-item {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            background-color: #fff8f8;
            border-left: 4px solid var(--primary-color);
        }

        .warning-item {
            border-left-color: var(--warning-color);
            background-color: #fffdf2;
        }

        .info-item {
            border-left-color: var(--secondary-color);
            background-color: #f2fffe;
        }

        .error-message {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .error-context {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            display: inline-block;
            margin-top: 5px;
        }

        .highlight {
            background-color: rgba(255, 215, 0, 0.3);
            padding: 0 2px;
        }

        .no-errors {
            text-align: center;
            padding: 20px;
            color: var(--secondary-color);
            font-weight: bold;
        }

        .hidden {
            display: none;
        }

        .examples-section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
        }

        .examples-list {
            margin-top: 15px;
        }

        .example-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .example-item:last-child {
            border-bottom: none;
        }

        .example-text {
            font-style: italic;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .example-translation {
            font-weight: bold;
            color: var(--primary-color);
        }

        footer {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Toki Pona Grammar Checker</h1>
            <p class="subtitle">Check your Toki Pona sentences for common grammar mistakes</p>
        </header>

        <div class="app-container">
            <div class="input-section">
                <textarea id="toki-pona-input" placeholder="Enter your Toki Pona text here..."></textarea>
                <div class="button-group">
                    <button class="check-btn" id="check-grammar">Check Grammar</button>
                    <button class="clear-btn" id="clear-text">Clear Text</button>
                    <button class="examples-btn" id="toggle-examples">Show Examples</button>
                </div>
            </div>

            <div class="results-section">
                <h2>Results</h2>
                <div id="loading" class="hidden">Checking grammar...</div>
                <ul id="error-list" class="error-list">
                    <li class="no-errors">No text to check yet. Enter some Toki Pona and click "Check Grammar".</li>
                </ul>
            </div>

            <div id="examples-section" class="examples-section hidden">
                <h2>Toki Pona Examples</h2>
                <div class="examples-list">
                    <div class="example-item">
                        <div class="example-text">mi pona e sina</div>
                        <div class="example-translation">I make you good / I fix you</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">sina moku e kili</div>
                        <div class="example-translation">You eat the fruit</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">ona li lukin e waso</div>
                        <div class="example-translation">They look at the bird</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">ni li suwi a</div>
                        <div class="example-translation">This is so sweet!</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">mi wile tawa tomo sina</div>
                        <div class="example-translation">I want to go to your house</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">jan li pana e moku tawa soweli</div>
                        <div class="example-translation">The person gives food to the animal</div>
                    </div>
                    <div class="example-item">
                        <div class="example-text">tomo pi jan lili</div>
                        <div class="example-translation">House of children / Children's house</div>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>Made with ❤️ for Toki Pona learners | Not an official tool</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const inputTextarea = document.getElementById('toki-pona-input');
            const checkGrammarBtn = document.getElementById('check-grammar');
            const clearTextBtn = document.getElementById('clear-text');
            const toggleExamplesBtn = document.getElementById('toggle-examples');
            const examplesSection = document.getElementById('examples-section');
            const errorList = document.getElementById('error-list');
            const loadingIndicator = document.getElementById('loading');

            // Toki Pona word lists
            const officialWords = [
                'a', 'ala', 'ale', 'anpa', 'ante', 'anu', 'awen', 'e', 'en', 'esun', 'ijo', 'ike', 'ilo', 'insa', 
                'jaki', 'jan', 'jelo', 'jo', 'kala', 'kalama', 'kama', 'kasi', 'ken', 'kepeken', 'kili', 'kin', 
                'kiwen', 'ko', 'kon', 'kule', 'kulupu', 'kute', 'la', 'lape', 'laso', 'lawa', 'len', 'lete', 'li', 
                'lili', 'linja', 'lipu', 'loje', 'lon', 'luka', 'lukin', 'lupa', 'ma', 'mama', 'mani', 'meli', 'mi', 
                'mije', 'moku', 'moli', 'monsi', 'mu', 'mun', 'musi', 'mute', 'nanpa', 'nasa', 'nasin', 'nena', 'ni', 
                'nimi', 'noka', 'o', 'olin', 'ona', 'open', 'pakala', 'pali', 'palisa', 'pan', 'pana', 'pi', 'pilin', 
                'pimeja', 'pini', 'pipi', 'poka', 'poki', 'pona', 'pu', 'sama', 'seli', 'selo', 'seme', 'sewi', 
                'sijelo', 'sike', 'sin', 'sina', 'sinpin', 'sitelen', 'sona', 'soweli', 'suli', 'suno', 'supa', 
                'suwi', 'tan', 'taso', 'tawa', 'telo', 'tenpo', 'toki', 'tomo', 'tu', 'unpa', 'uta', 'utala', 
                'walo', 'wan', 'waso', 'wawa', 'weka', 'wile'
            ];

            const commonNonOfficialWords = [
                'epiku', 'jasima', 'kijetesantakalu', 'kin', 'kipisi', 'kokosila', 'ku', 'lanpan', 'leko', 'meso', 
                'misikeke', 'monsuta', 'n', 'namako', 'oko', 'pake', 'pata', 'po', 'polinpin', 'pom', 'pop', 'samu', 
                'soto', 'te', 'tiki', 'tonsi', 'u', 'um', 'unu', 'wa', 'wuwojiti', 'yupekosi'
            ];

            // Event Listeners
            checkGrammarBtn.addEventListener('click', checkGrammar);
            clearTextBtn.addEventListener('click', clearText);
            toggleExamplesBtn.addEventListener('click', toggleExamples);

            // Functions
            function checkGrammar() {
                const text = inputTextarea.value.trim();
                
                if (!text) {
                    showNoTextMessage();
                    return;
                }

                showLoading();
                
                // Simulate processing delay
                setTimeout(() => {
                    const errors = analyzeText(text);
                    displayResults(errors);
                }, 500);
            }

            function analyzeText(text) {
                const errors = [];
                const sentences = splitSentences(text);
                
                sentences.forEach((sentence, sentenceIndex) => {
                    const words = sentence.trim().split(/\s+/);
                    
                    // Check for invalid words first
                    checkInvalidWords(words, sentence, sentenceIndex, errors);
                    
                    // Check sentence structure
                    checkSentenceStructure(words, sentence, sentenceIndex, errors);
                    
                    // Check for proper "e" usage (objects)
                    checkObjectMarkerE(words, sentence, sentenceIndex, errors);
                    
                    // Check for proper "pi" usage (possession)
                    checkPossessivePi(words, sentence, sentenceIndex, errors);
                    
                    // Check for proper "la" usage
                    checkContextMarkerLa(words, sentence, sentenceIndex, errors);
                });
                
                return errors;
            }

            function splitSentences(text) {
                // Split by sentence-ending punctuation but keep the punctuation
                return text.match(/[^.!?]+[.!?]*/g) || [];
            }

            function checkInvalidWords(words, sentence, sentenceIndex, errors) {
                words.forEach((word, wordIndex) => {
                    const cleanWord = word.replace(/[^a-zA-Z]/g, '').toLowerCase();
                    
                    if (!officialWords.includes(cleanWord)) {
                        if (!commonNonOfficialWords.includes(cleanWord)) {
                            errors.push({
                                type: 'error',
                                message: `"${cleanWord}" might not be a valid Toki Pona word`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex },
                                suggestion: 'Check the official word list or community words'
                            });
                        } else {
                            errors.push({
                                type: 'warning',
                                message: `"${cleanWord}" is a common non-official word`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex },
                                suggestion: 'Be aware this might not be understood by all speakers'
                            });
                        }
                    }
                });
            }

            function checkSentenceStructure(words, sentence, sentenceIndex, errors) {
                if (words.length === 0) return;
                
                const firstWord = words[0].toLowerCase();
                
                // Check for "li" usage after "mi" or "sina"
                if (words.length > 1) {
                    if ((firstWord === 'mi' || firstWord === 'sina') && words[1].toLowerCase() === 'li') {
                        errors.push({
                            type: 'error',
                            message: `"${firstWord}" should not be followed by "li"`,
                            context: sentence,
                            position: { sentenceIndex, wordIndex: 1 },
                            suggestion: `Remove "li" after "${firstWord}"`
                        });
                    }
                }
                
                // Check for missing "li" after other subjects
                if (words.length > 1) {
                    if (firstWord !== 'mi' && firstWord !== 'sina' && firstWord !== 'o' && 
                        words[1].toLowerCase() !== 'li') {
                        errors.push({
                            type: 'error',
                            message: 'Missing "li" after subject',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: 1 },
                            suggestion: 'Add "li" after the subject'
                        });
                    }
                }
            }

            function checkObjectMarkerE(words, sentence, sentenceIndex, errors) {
                const eIndices = [];
                words.forEach((word, index) => {
                    if (word.toLowerCase() === 'e') eIndices.push(index);
                });
                
                eIndices.forEach(eIndex => {
                    // Check if "e" is at the start
                    if (eIndex === 0) {
                        errors.push({
                            type: 'error',
                            message: '"e" should not be at the start of a sentence',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: eIndex },
                            suggestion: 'Add a subject and verb before "e"'
                        });
                    }
                    
                    // Check if "e" is at the end
                    if (eIndex === words.length - 1) {
                        errors.push({
                            type: 'error',
                            message: '"e" should not be at the end of a sentence',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: eIndex },
                            suggestion: 'Add a direct object after "e"'
                        });
                    }
                    
                    // Check if there's a word after "e"
                    if (eIndex < words.length - 1) {
                        const nextWord = words[eIndex + 1].toLowerCase();
                        if (nextWord === 'e' || nextWord === 'pi' || nextWord === 'la') {
                            errors.push({
                                type: 'error',
                                message: `"e" should be followed by a noun, not "${nextWord}"`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex: eIndex + 1 },
                                suggestion: 'Add a direct object after "e"'
                            });
                        }
                    }
                    
                    // Check if there's a verb before "e"
                    let hasVerbBefore = false;
                    for (let i = 0; i < eIndex; i++) {
                        const word = words[i].toLowerCase();
                        if (word !== 'li' && word !== 'mi' && word !== 'sina' && word !== 'ona') {
                            hasVerbBefore = true;
                            break;
                        }
                    }
                    
                    if (!hasVerbBefore) {
                        errors.push({
                            type: 'error',
                            message: 'Missing verb before "e"',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: eIndex },
                            suggestion: 'Add a verb before "e" to indicate the action'
                        });
                    }
                });
            }

            function checkPossessivePi(words, sentence, sentenceIndex, errors) {
                const piIndices = [];
                words.forEach((word, index) => {
                    if (word.toLowerCase() === 'pi') piIndices.push(index);
                });
                
                piIndices.forEach(piIndex => {
                    // Check if "pi" is at the start
                    if (piIndex === 0) {
                        errors.push({
                            type: 'error',
                            message: '"pi" should not be at the start of a sentence',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: piIndex },
                            suggestion: 'Add a noun before "pi"'
                        });
                    }
                    
                    // Check if "pi" is at the end
                    if (piIndex === words.length - 1) {
                        errors.push({
                            type: 'error',
                            message: '"pi" should not be at the end of a sentence',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: piIndex },
                            suggestion: 'Add a modifier after "pi"'
                        });
                    }
                    
                    // Check for consecutive "pi"
                    if (piIndex > 0 && words[piIndex - 1].toLowerCase() === 'pi') {
                        errors.push({
                            type: 'error',
                            message: 'Consecutive "pi" words',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: piIndex },
                            suggestion: 'Avoid multiple "pi" in a row'
                        });
                    }
                    
                    // Check if there's a modifier after "pi"
                    if (piIndex < words.length - 1) {
                        const nextWord = words[piIndex + 1].toLowerCase();
                        if (nextWord === 'e' || nextWord === 'pi' || nextWord === 'la') {
                            errors.push({
                                type: 'error',
                                message: `"pi" should be followed by a modifier, not "${nextWord}"`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex: piIndex + 1 },
                                suggestion: 'Add a modifier after "pi"'
                            });
                        }
                    }
                    
                    // Check if there's a noun before "pi"
                    if (piIndex > 0) {
                        const prevWord = words[piIndex - 1].toLowerCase();
                        if (prevWord === 'e' || prevWord === 'li' || prevWord === 'o') {
                            errors.push({
                                type: 'error',
                                message: `"pi" should be preceded by a noun, not "${prevWord}"`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex: piIndex - 1 },
                                suggestion: 'Add a noun before "pi"'
                            });
                        }
                    }
                });
            }

            function checkContextMarkerLa(words, sentence, sentenceIndex, errors) {
                const laIndex = words.findIndex(w => w.toLowerCase() === 'la');
                if (laIndex >= 0) {
                    // Check if "la" is at the start
                    if (laIndex === 0) {
                        errors.push({
                            type: 'warning',
                            message: '"la" at the start of a sentence might be unclear',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: laIndex },
                            suggestion: 'Consider adding context before "la"'
                        });
                    }
                    
                    // Check if "la" is at the end
                    if (laIndex === words.length - 1) {
                        errors.push({
                            type: 'error',
                            message: '"la" should not be at the end of a sentence',
                            context: sentence,
                            position: { sentenceIndex, wordIndex: laIndex },
                            suggestion: 'Add a main clause after "la"'
                        });
                    }
                    
                    // Check if there's content after "la"
                    if (laIndex < words.length - 1) {
                        const nextWord = words[laIndex + 1].toLowerCase();
                        if (nextWord === 'e' || nextWord === 'pi' || nextWord === 'la') {
                            errors.push({
                                type: 'error',
                                message: `"la" should be followed by a main clause, not "${nextWord}"`,
                                context: sentence,
                                position: { sentenceIndex, wordIndex: laIndex + 1 },
                                suggestion: 'Add a main clause after "la"'
                            });
                        }
                    }
                }
            }

            function displayResults(errors) {
                hideLoading();
                
                if (errors.length === 0) {
                    errorList.innerHTML = '<li class="no-errors">No grammar issues found! 🎉</li>';
                    return;
                }
                
                errorList.innerHTML = '';
                
                errors.forEach(error => {
                    const li = document.createElement('li');
                    li.className = `error-item ${error.type}-item`;
                    
                    const message = document.createElement('div');
                    message.className = 'error-message';
                    message.textContent = error.message;
                    
                    const suggestion = document.createElement('div');
                    suggestion.textContent = `Suggestion: ${error.suggestion}`;
                    
                    const context = document.createElement('div');
                    context.className = 'error-context';
                    
                    // Highlight the problematic word in context
                    const words = error.context.split(/\s+/);
                    if (error.position && error.position.wordIndex >= 0 && error.position.wordIndex < words.length) {
                        words[error.position.wordIndex] = `<span class="highlight">${words[error.position.wordIndex]}</span>`;
                    }
                    context.innerHTML = words.join(' ');
                    
                    li.appendChild(message);
                    li.appendChild(suggestion);
                    li.appendChild(context);
                    
                    errorList.appendChild(li);
                });
            }

            function showNoTextMessage() {
                errorList.innerHTML = '<li class="no-errors">Please enter some Toki Pona text to check.</li>';
            }

            function clearText() {
                inputTextarea.value = '';
                showNoTextMessage();
            }

            function showLoading() {
                loadingIndicator.classList.remove('hidden');
                errorList.classList.add('hidden');
            }

            function hideLoading() {
                loadingIndicator.classList.add('hidden');
                errorList.classList.remove('hidden');
            }

            function toggleExamples() {
                const isHidden = examplesSection.classList.contains('hidden');
                examplesSection.classList.toggle('hidden');
                toggleExamplesBtn.textContent = isHidden ? 'Hide Examples' : 'Show Examples';
                
                // Scroll to examples if showing
                if (isHidden) {
                    examplesSection.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
    </script>
</body>
</html>
