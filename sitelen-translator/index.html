<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toki Pona Translator</title>
    <!-- Include Sitelen Sitelen renderer -->
    <script src="https://kelasmaster.github.io/tokipona/sitelensitelen.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --background-color: #f8f9fa;
            --text-color: #333;
            --light-color: #fff;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
            --border-radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        header {
            background-color: var(--primary-color);
            color: var(--light-color);
            padding: 20px 0;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .translator-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (min-width: 768px) {
            .translator-container {
                flex-direction: row;
            }
        }

        .input-section, .output-section {
            flex: 1;
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            position: relative;
        }

        h2 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            background-color: var(--primary-color);
            color: var(--light-color);
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            white-space: nowrap;
        }

        button:hover {
            background-color: var(--secondary-color);
        }

        button.secondary {
            background-color: #6c757d;
        }

        button.secondary:hover {
            background-color: #5a6268;
        }

        .language-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .language-toggle button {
            flex: 1;
        }

        .language-toggle button.active {
            background-color: var(--secondary-color);
            font-weight: bold;
        }

        .suggestions {
            position: absolute;
            width: calc(100% - 40px);
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 100;
            display: none;
        }

        .suggestion-item {
            padding: 10px;
            cursor: pointer;
        }

        .suggestion-item:hover {
            background-color: #f0f0f0;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            background-color: #f1f1f1;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid var(--primary-color);
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .input-language {
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--secondary-color);
        }

        .output-language {
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .output-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .symbol-converters {
            display: none;
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
        }
        
        .symbol-converters.active {
            display: block;
        }
        
        .symbol-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .symbol-output {
            margin-top: 20px;
        }
        
        .symbol-output h3 {
            margin-bottom: 10px;
            color: var(--secondary-color);
        }
        
        .symbol-canvas {
            width: 100%;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        
        @font-face {
            font-family: 'linja-pona';
            src: url('https://cdn.jsdelivr.net/gh/janSame/linja-pona@latest/linja-pona-4.1.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        
        .linja-pona {
            font-family: 'linja-pona', sans-serif;
            font-size: 2rem;
            line-height: 1.5;
            padding: 20px;
        }

        #sitelenSitelenContainer {
            width: 100%;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 20px;
        }
        
        #sitelenSitelenContainer svg {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <body>
    <header>
        <div class="container">
            <h1>Toki Pona Translator</h1>
            <p class="subtitle">Translate between Toki Pona, English, and Indonesian</p>
        </div>
    </header>

    <main class="container">
        <div class="translator-container">
            <section class="input-section">
                <h2>Input Text</h2>
                <div class="input-language">Input Language: <span id="inputLangDisplay">Toki Pona</span></div>
                <textarea id="inputText" placeholder="Enter text here..."></textarea>
                <div class="suggestions" id="suggestions"></div>
                <div class="button-group">
                    <button id="setInputToki" class="active">Toki Pona</button>
                    <button id="setInputEnglish">English</button>
                    <button id="setInputIndonesian">Indonesian</button>
                </div>
                <button id="translateBtn">Translate</button>
                <div class="button-group" id="symbolButtons" style="display: none;">
                    <button id="sitelenPonaBtn">Sitelen Pona</button>
                    <button id="sitelenSitelenBtn">Sitelen Sitelen</button>
                </div>
                <div class="loading" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p>Translating...</p>
                </div>
            </section>

            <section class="output-section">
                <h2>Translation</h2>
                <div class="output-language">Output Language: <span id="outputLangDisplay">English</span></div>
                <textarea id="outputText" placeholder="Translation will appear here..." readonly></textarea>
                <div class="language-toggle">
                    <button id="outputEnglish" class="active">English</button>
                    <button id="outputIndonesian">Indonesian</button>
                    <button id="outputTokiPona">Toki Pona</button>
                </div>
                <div class="output-actions">
                    <button id="copyBtn">Copy Translation</button>
                </div>
            </section>
        </div>

        <section class="symbol-converters" id="symbolConverters">
            <div id="sitelenPonaOutput" class="symbol-output">
                <h3>Sitelen Pona Output</h3>
                <div class="symbol-canvas linja-pona" id="sitelenPonaText"></div>
                <div class="output-actions">
                    <button id="downloadSitelenPona">Download as Image</button>
                </div>
            </div>
            
            <div id="sitelenSitelenOutput" class="symbol-output">
                <h3>Sitelen Sitelen Output</h3>
                <div class="symbol-canvas" id="sitelenSitelenContainer">
                    <div class="symbol-sitelen" id="sitelenSitelenText"></div>
                </div>
                <div class="output-actions">
                    <button id="downloadSitelenSitelen">Download as PNG</button>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Â© <span id="currentYear"></span> - Toki Pona Translator</p>
        </div>
    </footer>

    <script>
         // Current year for footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        // Smaller Toki Pona dictionary sample
        const nimi = {
            "a": ["ah! ha! uh!", "ah! ha! uh! oh! (ekspresi emosional)"],
            "akesi": ["non-cute animal (reptile, amphibian)", "hewan bukan lucu (reptil, amfibi)"],
            "ala": ["no, not, none, un-", "tidak, bukan, tidak ada"],
            "ale": ["all, every, complete, abundance", "semua, seluruh, lengkap, banyak"],
            "ali": ["all, every, complete, abundance", "semua, seluruh, lengkap, banyak"],
            "anpa": ["bowing, low, beneath, defeated", "merunduk, di bawah, kalah"],
            "ante": ["different, changed, other", "berbeda, berubah, lain"],
            "anu": ["or (used in questions)", "atau (untuk pertanyaan)"],
            "awen": ["enduring, kept, safe, staying", "bertahan, tetap, aman"],
            "e": ["(object marker before direct object)", "(penanda objek)"],
            "en": ["and (used between nouns)", "dan (antar kata benda)"],
            "ijo": ["thing, object, matter", "benda, hal"],
            "ike": ["bad, negative, wrong, evil", "buruk, jahat"],
            "ilo": ["tool, device, machine", "alat, mesin"],
            "insa": ["inside, contents, center", "dalam, isi"],
            "jaki": ["dirty, gross, toxic", "kotor, menjijikkan"],
            "jan": ["person, human, somebody", "orang, manusia"],
            "jelo": ["yellow", "kuning"],
            "jo": ["have, contain", "memiliki, berisi"],
            "kala": ["fish, sea creature", "ikan, hewan laut"],
            "kalama": ["sound, noise", "suara, bunyi"],
            "kama": ["to come, become, event", "datang, menjadi"],
            "kasi": ["plant, vegetation", "tanaman"],
            "ken": ["can, may, possibility", "bisa, mungkin"],
            "kili": ["fruit, vegetable", "buah, sayuran"],
            "kiwen": ["hard object, rock, metal", "keras, batu, logam"],
            "ko": ["semi-solid, paste, powder", "lumpur, pasta, bubuk"],
            "kon": ["air, breath, spirit", "udara, napas, roh"],
            "kule": ["color, paint", "warna, cat"],
            "kulupu": ["group, community", "kelompok, komunitas"],
            "kute": ["hear, listen", "mendengar"],
            "la": ["(context marker)", "(penanda konteks)"],
            "lape": ["sleep, rest", "tidur, istirahat"],
            "laso": ["blue, green", "biru, hijau"],
            "lawa": ["head, lead", "kepala, memimpin"],
            "len": ["clothing, fabric", "pakaian, kain"],
            "lete": ["cold, uncooked", "dingin, mentah"],
            "li": ["(verb marker)", "(penanda kata kerja)"],
            "lili": ["small, little", "kecil"],
            "linja": ["line, rope", "garis, tali"],
            "lipu": ["paper, book", "kertas, buku"],
            "loje": ["red", "merah"],
            "lon": ["true, present", "benar, ada"],
            "luka": ["hand, five", "tangan, lima"],
            "lukin": ["see, look", "melihat"],
            "lupa": ["hole, opening", "lubang, pintu"],
            "ma": ["land, country", "tanah, negara"],
            "mama": ["parent, ancestor", "orang tua, leluhur"],
            "mani": ["money, value", "uang, nilai"],
            "meli": ["woman", "perempuan"],
            "mi": ["I, me", "saya, aku"],
            "mije": ["man", "laki-laki"],
            "moku": ["eat, food", "makan, makanan"],
            "moli": ["die, death", "mati"],
            "monsi": ["back", "belakang"],
            "mu": ["(animal sound)", "(suara binatang)"],
            "mun": ["moon, star", "bulan, bintang"],
            "musi": ["fun, play", "bersenang-senang, bermain"],
            "mute": ["many, much", "banyak"],
            "nasa": ["crazy, weird", "gila, aneh"],
            "nasin": ["way, path", "jalan, cara"],
            "nena": ["bump, nose", "benjolan, hidung"],
            "ni": ["this, that", "ini, itu"],
            "nimi": ["name, word", "nama, kata"],
            "noka": ["foot, leg", "kaki"],
            "o": ["hey!", "hai!"],
            "oko": ["eye", "mata"],
            "olin": ["love", "cinta"],
            "ona": ["he, she, they", "dia, mereka"],
            "open": ["open, begin", "buka, mulai"],
            "pakala": ["break, damage", "rusak, celaka"],
            "pali": ["do, make", "melakukan, membuat"],
            "palisa": ["long stick", "tongkat, batang"],
            "pan": ["bread, grain", "roti, gandum"],
            "pana": ["give, release", "memberi, melepaskan"],
            "pi": ["of (modifier)", "dari (pengelompokan)"],
            "pilin": ["feel, emotion", "perasaan, hati"],
            "pimeja": ["black", "hitam"],
            "pini": ["end, finish", "akhir, selesai"],
            "pipi": ["insect", "serangga"],
            "poka": ["side, with", "sisi, dengan"],
            "poki": ["container", "wadah, kotak"],
            "pona": ["good, simple", "baik, sederhana"],
            "sama": ["same, sibling", "sama, saudara"],
            "seli": ["fire, heat", "api, panas"],
            "selo": ["outside, skin", "luar, kulit"],
            "seme": ["what?", "apa?"],
            "sewi": ["sacred, high", "tinggi, suci"],
            "sijelo": ["body", "tubuh"],
            "sike": ["circle, cycle", "lingkaran, siklus"],
            "sin": ["new, another", "baru, lain"],
            "sina": ["you", "kamu"],
            "sinpin": ["front, face", "depan, wajah"],
            "sitelen": ["image, write", "gambar, menulis"],
            "sona": ["know, understand", "tahu, mengerti"],
            "soweli": ["animal (land)", "hewan darat"],
            "suli": ["big, important", "besar, penting"],
            "suno": ["sun, light", "matahari, cahaya"],
            "supa": ["surface, table", "permukaan, meja"],
            "suwi": ["sweet, cute", "manis, lucu"],
            "tan": ["from, because", "dari, karena"],
            "taso": ["but, only", "tapi, hanya"],
            "tawa": ["go, move", "pergi, bergerak"],
            "telo": ["water, liquid", "air, cairan"],
            "tenpo": ["time", "waktu"],
            "toki": ["speak, language", "bicara, bahasa"],
            "tomo": ["house, building", "rumah, bangunan"],
            "tu": ["two", "dua"],
            "unpa": ["sex", "seks"],
            "uta": ["mouth", "mulut"],
            "utala": ["fight", "bertarung"],
            "walo": ["white", "putih"],
            "wan": ["one", "satu"],
            "waso": ["bird", "burung"],
            "wawa": ["power", "kuat, tenaga"],
            "weka": ["away, absent", "tidak ada, jauh"],
            "wile": ["want, need", "ingin, butuh"]
        };

        // DOM elements
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const translateBtn = document.getElementById('translateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const suggestions = document.getElementById('suggestions');
        const inputLangDisplay = document.getElementById('inputLangDisplay');
        const outputLangDisplay = document.getElementById('outputLangDisplay');
        const symbolButtons = document.getElementById('symbolButtons');
        const sitelenPonaBtn = document.getElementById('sitelenPonaBtn');
        const sitelenSitelenBtn = document.getElementById('sitelenSitelenBtn');
        const sitelenPonaOutput = document.getElementById('sitelenPonaOutput');
        const sitelenSitelenOutput = document.getElementById('sitelenSitelenOutput');
        const sitelenPonaText = document.getElementById('sitelenPonaText');
        const sitelenSitelenText = document.getElementById('sitelenSitelenText');
        const downloadSitelenPona = document.getElementById('downloadSitelenPona');
        const downloadSitelenSitelen = document.getElementById('downloadSitelenSitelen');

        // Input language buttons
        const setInputToki = document.getElementById('setInputToki');
        const setInputEnglish = document.getElementById('setInputEnglish');
        const setInputIndonesian = document.getElementById('setInputIndonesian');

        // Output language buttons
        const outputEnglish = document.getElementById('outputEnglish');
        const outputIndonesian = document.getElementById('outputIndonesian');
        const outputTokiPona = document.getElementById('outputTokiPona');

        // State variables
        let currentInputLanguage = 'toki'; // 'toki', 'en', 'id'
        let currentOutputLanguage = 'en'; // 'en', 'id', 'toki'

        // Set input language
        function setInputLanguage(lang) {
            currentInputLanguage = lang;
            inputLangDisplay.textContent = 
                lang === 'toki' ? 'Toki Pona' : 
                lang === 'en' ? 'English' : 'Indonesian';
            
            // Update button states
            setInputToki.classList.toggle('active', lang === 'toki');
            setInputEnglish.classList.toggle('active', lang === 'en');
            setInputIndonesian.classList.toggle('active', lang === 'id');
            
            // Update placeholder text
            inputText.placeholder = lang === 'toki' ? 'Enter Toki Pona text here...' : 
                                   lang === 'en' ? 'Enter English text here...' : 
                                   'Enter Indonesian text here...';
            
            // Show/hide symbol buttons based on input language
            if (lang === 'toki') {
                symbolButtons.style.display = 'flex';
            } else {
                symbolButtons.style.display = 'none';
                document.getElementById('symbolConverters').classList.remove('active');
            }
        }

        // Set output language
        function setOutputLanguage(lang) {
            currentOutputLanguage = lang;
            outputLangDisplay.textContent = 
                lang === 'en' ? 'English' : 
                lang === 'id' ? 'Indonesian' : 'Toki Pona';
            
            // Update button states
            outputEnglish.classList.toggle('active', lang === 'en');
            outputIndonesian.classList.toggle('active', lang === 'id');
            outputTokiPona.classList.toggle('active', lang === 'toki');
            
            // If there's already a translation, update it
            if (outputText.value) {
                translateText();
            }
        }

        // Initialize languages
        setInputLanguage('toki');
        setOutputLanguage('en');

        // Event listeners for input language buttons
        setInputToki.addEventListener('click', () => setInputLanguage('toki'));
        setInputEnglish.addEventListener('click', () => setInputLanguage('en'));
        setInputIndonesian.addEventListener('click', () => setInputLanguage('id'));

        // Event listeners for output language buttons
        outputEnglish.addEventListener('click', () => setOutputLanguage('en'));
        outputIndonesian.addEventListener('click', () => setOutputLanguage('id'));
        outputTokiPona.addEventListener('click', () => setOutputLanguage('toki'));

        // Show word suggestions based on input
        inputText.addEventListener('input', function() {
            const text = this.value;
            const lastWord = text.split(/\s+/).pop().toLowerCase();
            
            if (lastWord.length < 2) {
                suggestions.style.display = 'none';
                return;
            }
            
            // Filter dictionary for matches
            const matches = Object.keys(nimi).filter(word => 
                word.toLowerCase().startsWith(lastWord))
                .slice(0, 10); // Limit to 10 suggestions
            
            if (matches.length === 0) {
                suggestions.style.display = 'none';
                return;
            }
            
            // Display suggestions
            suggestions.innerHTML = '';
            matches.forEach(word => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';
                div.textContent = word;
                div.addEventListener('click', () => {
                    const parts = text.split(/\s+/);
                    parts[parts.length - 1] = word;
                    this.value = parts.join(' ') + ' ';
                    suggestions.style.display = 'none';
                    this.focus();
                });
                suggestions.appendChild(div);
            });
            
            suggestions.style.display = 'block';
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target !== inputText) {
                suggestions.style.display = 'none';
            }
        });

        // Translate Toki Pona to English/Indonesian
        function translateTokiPona(text, targetLang) {
            // Split into words while preserving punctuation and tags
            const words = text.split(/(\s+|\W+)/);
            
            return words.map(word => {
                // Skip whitespace and punctuation
                if (!word.trim() || /^\W+$/.test(word)) {
                    return word;
                }
                
                const lowerWord = word.toLowerCase();
                
                // Check if word is in dictionary
                if (nimi.hasOwnProperty(lowerWord)) {
                    const translations = nimi[lowerWord];
                    // Return translation based on target language
                    return targetLang === 'en' ? translations[0] : translations[1] || translations[0];
                }
                
                // Special cases for common particles
                const specialCases = {
                    'li': targetLang === 'en' ? 'is' : 'adalah',
                    'la': targetLang === 'en' ? "it's said" : "dikatakan",
                    'e': targetLang === 'en' ? 'such' : 'seperti',
                    'o': targetLang === 'en' ? '(command)' : '(perintah)'
                };
                
                return specialCases[lowerWord] || word;
            }).join('');
        }

        // Translate English/Indonesian to Toki Pona (simplified)
        function translateToTokiPona(text, sourceLang) {
            // This is a simplified approach - in a real app you'd need a more sophisticated system
            const words = text.split(/(\s+|\W+)/);
            
            // Find Toki Pona words that match the English/Indonesian meaning
            return words.map(word => {
                if (!word.trim() || /^\W+$/.test(word)) {
                    return word;
                }
                
                const lowerWord = word.toLowerCase();
                
                // Search the dictionary for matches
                for (const [tokiWord, translations] of Object.entries(nimi)) {
                    if (sourceLang === 'en' && translations[0].toLowerCase().includes(lowerWord)) {
                        return tokiWord;
                    }
                    if (sourceLang === 'id' && translations[1] && translations[1].toLowerCase().includes(lowerWord)) {
                        return tokiWord;
                    }
                }
                
                return word;
            }).join('');
        }

        // Handle translation
        function translateText() {
            const text = inputText.value.trim();
            
            if (!text) {
                alert('Please enter some text to translate');
                return;
            }
            
            // Show loading indicator
            loadingIndicator.style.display = 'block';
            
            // Simulate processing delay (remove in production)
            setTimeout(() => {
                let translation;
                
                if (currentInputLanguage === 'toki') {
                    // Translate from Toki Pona to English/Indonesian/Toki Pona
                    if (currentOutputLanguage === 'toki') {
                        translation = text; // No translation needed
                    } else {
                        translation = translateTokiPona(text, currentOutputLanguage);
                    }
                } else {
                    // Translate from English/Indonesian to Toki Pona
                    translation = translateToTokiPona(text, currentInputLanguage);
                    
                    // If output language is not Toki Pona (translate to English/Indonesian)
                    if (currentOutputLanguage !== 'toki') {
                        translation = translateTokiPona(translation, currentOutputLanguage);
                    }
                }
                
                outputText.value = translation;
                loadingIndicator.style.display = 'none';
            }, 500);
        }

        // Handle translation button click
        translateBtn.addEventListener('click', translateText);

        // Handle copy button click
        copyBtn.addEventListener('click', () => {
            outputText.select();
            document.execCommand('copy');
            
            // Visual feedback
            const originalText = copyBtn.textContent;
            copyBtn.textContent = 'Copied!';
            setTimeout(() => {
                copyBtn.textContent = originalText;
            }, 2000);
        });

        // Allow translation with Enter key (Shift+Enter for new line)
        inputText.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                translateBtn.click();
            }
        });

        // Sitelen Pona functions
        function renderSitelenPona() {
            const text = inputText.value.trim();
            if (!text) return;
            
            sitelenPonaText.textContent = text;
            sitelenPonaOutput.style.display = 'block';
            sitelenSitelenOutput.style.display = 'none';
            
            // Show the container
            document.getElementById('symbolConverters').classList.add('active');
        }

        function downloadSitelenPonaImage() {
            // Create a canvas to render the text for download
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Set canvas dimensions
            canvas.width = 800;
            canvas.height = 200;
            
            // Set font
            ctx.font = '40px linja-pona';
            ctx.textBaseline = 'top';
            
            // Draw white background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw text
            ctx.fillStyle = 'black';
            ctx.fillText(sitelenPonaText.textContent, 10, 10);
            
            // Create download link
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = 'sitelen-pona.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        // Sitelen Sitelen functions
        function renderSitelenSitelen() {
            const text = inputText.value.trim();
            if (!text) {
                alert('Please enter some Toki Pona text first');
                return;
            }
            
            // Clear previous content
            sitelenSitelenText.innerHTML = '';
            
            try {
                // Use the Sitelen Sitelen renderer
                console.log('Attempting to parse text:', text);
                const structuredSentence = sitelenParser.parse(text)[0];
                console.log('Parsed successfully:', structuredSentence);
                
                // Render with default options
                sitelenRenderer.renderInteractiveSentence(structuredSentence, {
                    shadow: true,
                    container: sitelenSitelenText
                });
                
                console.log('Rendering completed');
                sitelenSitelenOutput.style.display = 'block';
                sitelenPonaOutput.style.display = 'none';
                
                // Show the container
                document.getElementById('symbolConverters').classList.add('active');
            } catch (e) {
                console.error("Error rendering Sitelen Sitelen:", e);
                sitelenSitelenText.innerHTML = '<p>Error rendering Sitelen Sitelen. Please try simpler text.</p>';
                document.getElementById('symbolConverters').classList.add('active');
            }
        }

        function downloadSitelenSitelenImage() {
            const svgElement = sitelenSitelenText.querySelector('svg');
            if (!svgElement) {
                alert('No Sitelen Sitelen image to download');
                return;
            }
            
            try {
                // Create a canvas element
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                // Get SVG dimensions
                const width = svgElement.width.baseVal.value;
                const height = svgElement.height.baseVal.value;
                
                // Set canvas dimensions
                canvas.width = width;
                canvas.height = height;
                
                // Create an image from the SVG
                const svgData = new XMLSerializer().serializeToString(svgElement);
                const img = new Image();
                const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
                const url = URL.createObjectURL(svgBlob);
                
                img.onload = function() {
                    // Draw the image on canvas
                    ctx.drawImage(img, 0, 0);
                    URL.revokeObjectURL(url);
                    
                    // Create download link
                    const downloadLink = document.createElement('a');
                    const text = inputText.value.trim() || 'sitelen-sitelen';
                    const filename = text.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_') + '.png';
                    
                    downloadLink.href = canvas.toDataURL('image/png');
                    downloadLink.download = filename;
                    document.body.appendChild(downloadLink);
                    downloadLink.click();
                    document.body.removeChild(downloadLink);
                };
                
                img.onerror = function() {
                    alert('Error generating image. Please try again.');
                };
                
                img.src = url;
            } catch (e) {
                console.error("Error downloading Sitelen Sitelen:", e);
                alert('Error generating download. Please try again.');
            }
        }

        // Event listeners for symbol converter buttons
        sitelenPonaBtn.addEventListener('click', renderSitelenPona);
        sitelenSitelenBtn.addEventListener('click', renderSitelenSitelen);
        downloadSitelenPona.addEventListener('click', downloadSitelenPonaImage);
        downloadSitelenSitelen.addEventListener('click', downloadSitelenSitelenImage);

        // Event listeners for symbol converter buttons - UPDATED TO ENSURE THEY WORK
        document.addEventListener('DOMContentLoaded', function() {
            // Check if buttons exist
            if (sitelenPonaBtn && sitelenSitelenBtn) {
                sitelenPonaBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    renderSitelenPona();
                });
                
                sitelenSitelenBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    renderSitelenSitelen();
                });
                
                console.log('Symbol buttons event listeners added successfully');
            } else {
                console.error('Symbol buttons not found in DOM');
            }

            // Check if renderer is loaded
            if (typeof sitelenRenderer !== 'undefined') {
                console.log('Sitelen Sitelen renderer loaded successfully');
            } else {
                console.error('Sitelen Sitelen renderer not loaded');
            }
        });

        // Test renderer with simple text
            try {
                const testText = "toki pona";
                const testContainer = document.createElement('div');
                const testSentence = sitelenParser.parse(testText)[0];
                sitelenRenderer.renderInteractiveSentence(testSentence, {
                    container: testContainer
                });
                console.log('Sitelen Sitelen test render successful');
            } catch (e) {
                console.error('Sitelen Sitelen test render failed:', e);
            }
        });
    </script>
</body>
</html>
