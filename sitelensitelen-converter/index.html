<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitelen Sitelen Converter</title>
    
    <!-- External Scripts -->
    <script src="https://kelasmaster.github.io/tokipona/sitelensitelen.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Custom Styles -->
    <style>
        :root {
            --primary: #3273dc;
            --primary-hover: #276cda;
            --text: #363636;
            --border: #dbdbdb;
            --shadow: 0 0.5em 1em -0.125em rgba(10,10,10,0.1);
            --radius: 6px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            color: var(--text);
            line-height: 1.5;
            padding: 1rem;
            max-width: 1000px;
            margin: 0 auto;
            background-color: #f9f9f9;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            text-align: center;
            color: #d33;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .columns {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        .column {
            flex: 1;
            min-width: 300px;
        }
        
        .field {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .control {
            position: relative;
        }
        
        #tokiInput {
            width: 100%;
            padding: 0.75em;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: border-color 0.15s ease;
            font-family: inherit;
            min-height: 60px;
            resize: vertical;
        }
        
        #tokiInput:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        
        button {
            padding: 0.5em 1em;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.15s ease;
        }
        
        button:hover {
            background-color: var(--primary-hover);
        }
        
        button.secondary {
            background-color: #666;
        }
        
        button.secondary:hover {
            background-color: #555;
        }
        
        #outputContainer {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            background-color: white;
            box-shadow: var(--shadow);
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        #sitelen {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        
        #sitelen svg {
            width: 100%;
            height: auto;
            max-height: 400px;
        }
        
        .settings {
            background-color: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
        }
        
        .checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .footer {
            margin-top: 3rem;
            text-align: center;
            font-size: 0.875rem;
            color: #666;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        .modal.is-active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        
        .example-text {
            color: var(--primary);
            cursor: pointer;
            text-decoration: underline;
            margin: 0.5rem 0;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .columns {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sitelen Sitelen Converter</h1>
        
        <div class="columns">
            <div class="column">
                <div class="field">
                    <label for="tokiInput">Enter Toki Pona text:</label>
                    <div class="control">
                        <textarea id="tokiInput" placeholder="jan Juto#" spellcheck="false"></textarea>
                    </div>
                    <div class="example-text" id="example1">Example 1: jan Juto#</div>
                    <div class="example-text" id="example2">Example 2: sitelen musi li lwaa mi, lawa li pilin pona.</div>
                    <div class="example-text" id="example3">Example 3: O kama pona! Mi toki open e mi</div>
                </div>
                
                <div class="buttons">
                    <button id="downloadButton">Download as PNG</button>
                    <button id="helpButton" class="secondary">Help</button>
                </div>
            </div>
            
            <div class="column">
                <div class="settings">
                    <h3>Settings</h3>
                    <div class="checkbox">
                        <input type="checkbox" id="shadowToggle" checked>
                        <label for="shadowToggle">Enable shadows</label>
                    </div>
                    <div class="checkbox">
                        <input type="checkbox" id="colorToggle">
                        <label for="colorToggle">Colorful background</label>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="outputContainer">
            <div id="sitelen"></div>
        </div>
    </div>
    
    <div class="modal" id="helpModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <h2>Sitelen Sitelen Converter Help</h2>
            <p>This tool converts Toki Pona text into Sitelen Sitelen hieroglyphs.</p>
            
            <h3>How to use:</h3>
            <p>1. Type Toki Pona text in the input box</p>
            <p>2. The hieroglyphs will appear automatically</p>
            <p>3. Click "Download as PNG" to save the image</p>
            
            <h3>Special syntax:</h3>
            <p><strong>Cartouches:</strong> Use square brackets for names/proper nouns: <code>jan [_ale]</code></p>
            <p><strong>Compound words:</strong> Use spaces between words: <code>tomo tawa</code></p>
            
            <h3>Examples:</h3>
            <ul>
                <li><code>mi olin e sina</code></li>
                <li><code>jan [_ale] li pona</code></li>
                <li><code>toki pona li pona</code></li>
            </ul>
        </div>
    </div>
    
    <footer class="footer">
        <p>Uses the sitelen-sitelen-renderer library. Not officially affiliated with Toki Pona.</p>
    </footer>

    <script>
        $(document).ready(function() {
            // Initialize modal
            const helpModal = $('#helpModal');
            $('#helpButton').click(() => helpModal.addClass('is-active'));
            $('#modalClose').click(() => helpModal.removeClass('is-active'));
            helpModal.click((e) => {
                if (e.target === helpModal[0]) helpModal.removeClass('is-active');
            });
            
            // Example text handlers
            $('#example1').click(() => {
                $('#tokiInput').val('jan Juto#');
                $('#tokiInput').trigger('input');
            });
            
            $('#example2').click(() => {
                $('#tokiInput').val('sitelen musi li lwaa mi, lawa li pilin pona.');
                $('#tokiInput').trigger('input');
            });
            
            $('#example3').click(() => {
                $('#tokiInput').val(' O kama pona! Mi toki open e mi');
                $('#tokiInput').trigger('input');
            });
            
            // Download button handler
            $('#downloadButton').click(downloadAsPNG);
            
            // Set default text and render
            $('#tokiInput').val('jan Juto#');
            $('#tokiInput').trigger('input');
        });
        
        function customBackground(color) {
            var ns = 'http://www.w3.org/2000/svg';
            var rect = document.createElementNS(ns, 'rect');
            rect.style.width = '200%';
            rect.style.height = '200%';
            rect.style.x = '-100%';
            rect.style.y = '-100%';
            rect.style.fill = color || 'lightblue';
            rect.style.stroke = 'none';
            return rect;
        }
        
        function renderInput() {
            var text = $('#tokiInput').val();
            var structuredSentence = sitelenParser.parse(text)[0];
            $('#sitelen').empty();
            
            var options = {
                shadow: $('#shadowToggle').is(':checked')
            };
            
            if ($('#colorToggle').is(':checked')) {
                options.output = {
                    format: 'png',
                    background: customBackground(getRandomColor())
                };
            }
            
            sitelenRenderer.renderInteractiveSentence(structuredSentence, options);
        }
        
        function getRandomColor() {
            const colors = [
                '#FFDDC1', '#C1FFD7', '#C1E0FF', '#F0C1FF', 
                '#FFF5C1', '#C1FFF5', '#E8C1FF', '#C1FFE8'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function downloadAsPNG() {
            // Find the SVG element
            const svgElement = $('#sitelen svg')[0];
            if (!svgElement) return;
            
            // Create a canvas element
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            
            // Get SVG dimensions
            const width = svgElement.width.baseVal.value;
            const height = svgElement.height.baseVal.value;
            
            // Set canvas dimensions
            canvas.width = width;
            canvas.height = height;
            
            // Create an image from the SVG
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const img = new Image();
            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
            const url = URL.createObjectURL(svgBlob);
            
            img.onload = function() {
                // Draw the image on canvas
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);
                
                // Create download link
                const downloadLink = document.createElement('a');
                const text = $('#tokiInput').val() || 'sitelen-sitelen';
                const filename = text.substring(0, 20).replace(/[^a-zA-Z0-9]/g, '_') + '.png';
                
                downloadLink.href = canvas.toDataURL('image/png');
                downloadLink.download = filename;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            };
            
            img.src = url;
        }
        
        // Set up event listeners
        $('#tokiInput').on('input', renderInput);
        $('#shadowToggle, #colorToggle').change(renderInput);
    </script>
</body>
</html>
